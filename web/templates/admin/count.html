{% extends 'common/layout_mainn.html' %}{% block css %}    <link rel="stylesheet" href="{{ buildStaticUrl('css/myPagination.css') }}">    <link rel="stylesheet" href="{{ buildStaticUrl('plugins/select2/css/select2.min.css') }}">    <link rel="stylesheet" href="{{ buildStaticUrl('plugins/multi-select/css/multi-select.css') }}">    <link rel="stylesheet" href="{{ buildStaticUrl('plugins/footable/css/footable.bootstrap.min.css') }}">    <link rel="stylesheet" href="{{ buildStaticUrl('plugins/footable/css/footable.standalone.min.css') }}">{% endblock %}{% block pcoded %}    <nav class="pcoded-navbar">        <div class="navbar-wrapper">            <div class="navbar-brand header-logo">                <a href="index.html" class="b-brand">                    <span class="b-title">后台管理系统</span>                </a>                <a class="mobile-menu" id="mobile-collapse" href="javascript:"><span></span></a>            </div>            <div class="navbar-content scroll-div">                <ul class="nav pcoded-inner-navbar">                    <li class="nav-item pcoded-menu-caption">                        <label>管理员</label>                    </li>                    <li data-username="dashboard Default Ecommerce CRM Analytics Crypto Project"                        class="nav-item pcoded-hasmenu active pcoded-trigger">                        <a href="javascript:" class="nav-link"><span class="pcoded-micon"><i                                class="feather icon-home"></i></span><span class="pcoded-mtext">管理员操作</span></a>                        <ul class="pcoded-submenu">                            <li class=""><a href="{{ buildUrl('/admin/index') }}" class="">报名统计</a></li>                            <li class="active"><a href="{{ buildUrl('/admin/count') }}" class="">部门统计</a></li>                            <li class=""><a href="{{ buildUrl('/admin/profession') }}" class="">期数管理</a></li>                            <li class=""><a href="{{ buildUrl('/admin/manager?id=1') }}" class="">管理员信息</a></li>                        </ul>                    </li>                </ul>            </div>        </div>    </nav>{% endblock %}{% block content %}    <div class="pcoded-main-container">        <div class="pcoded-wrapper">            <div class="pcoded-content">                <div class="pcoded-inner-content">                    <!-- [ breadcrumb ] start -->                    <div class="page-header">                        <div class="page-block">                            <div class="row align-items-center">                                <div class="col-md-12">                                    <div class="page-header-title">                                        <h5 class="m-b-10">管理员</h5>                                    </div>                                    <ul class="breadcrumb">                                        <li class="breadcrumb-item"><a href="javascript:"><i                                                class="feather icon-home"></i></a></li>                                        <li class="breadcrumb-item"><a href="javascript:">报名统计</a></li>                                    </ul>                                </div>                            </div>                        </div>                    </div>                    <div class="main-body">                        <div class="page-wrapper">                            <div class="col-xl-12">                                <div class="card">                                    <div class="card-header">                                        <h5>报名统计</h5>                                    </div>                                    <div class="row">                                        &nbsp;                                        <div class="col-xl-2 col-md-6 mb-5">                                            <select id="f0" class="js-example-placeholder-multiple col-sm-12">                                                <option value="0">请选择</option>                                                <option value="1">团省委</option>                                                <option value="2">省直团委</option>                                                <option value="3">省直高校团委</option>                                                <option value="4">省管企业团委</option>                                                <option value="5">市地团委</option>                                                <option value="6">民办高校团委</option>                                                <option value="7">其他</option>                                            </select>                                        </div>                                        <div class="col-xl-2 col-md-6 mb-5">                                            <select id="f1" class="js-example-placeholder-multiple col-sm-12">                                            </select>                                        </div>                                        <div class="col-xl-2 col-md-6 mb-5">                                            <select id="f2" class="js-example-placeholder-multiple col-sm-12">                                            </select>                                        </div>                                        <div class="col-xl-2 col-md-6 mb-5">                                            <select id="f3" class="js-example-placeholder-multiple col-sm-12">                                            </select>                                        </div>                                        <div class="col-xl-2 col-md-6 mb-5">                                            <select id="f4" class="js-example-placeholder-multiple col-sm-12">                                            </select>                                        </div>                                        <button type="button" class="btn btn-secondary" onclick="search()">查询                                        </button>                                    </div>                                    <div class="card-block table-border-style">                                        <div class="table-responsive">                                            <table id="testTable" class="table table-striped table-hover">                                                <thead>                                                <tr>                                                    <th>#</th>                                                    <th>部门</th>                                                    <th>团员统计人数</th>                                                    <th>参与人数</th>                                                    <th>参与率</th>                                                </tr>                                                </thead>                                                <tbody>                                                {% for item in list %}                                                    <tr>                                                        <th scope="row" style="font-size: 18px;">{{ item.did }}</th>                                                        <td style="font-size: 18px;">{{ item.f_name + item.d_name }}</td>                                                        <td><input type="number" id="{{ item.did }}inval"                                                                   style="font-size: 18px;" value="{{ item.joinnum }}"                                                                   onkeyup="setValue({{ item.did }})" class="inval"/>                                                        </td>                                                        <td id="{{ item.did }}num"                                                            style="font-size: 18px;">{{ item.num }}</td>                                                        <td id="{{ item.did }}valee" class="valee"                                                            style="font-size: 18px;">{{ item.joinpercent  }}</td>                                                    </tr>                                                {% endfor %}                                                <tr class="count">                                                    <td></td>                                                    <td>总计</td>                                                    <td><P id="totalNum1"></P></td>                                                    <td>{{ totalNum }}</td>                                                    <td><P id="totalNum2"></P></td>                                                </tr>                                                </tbody>                                            </table>                                        </div>                                    </div>                                    <div id="pagination" class="pagination"></div>                                </div>                            </div>                        </div>                    </div>                </div>            </div>        </div>    </div>{% endblock %}{% block js %}    <script src="{{ buildStaticUrl('js/myPagination.js') }}"></script>    <script src="{{ buildStaticUrl('plugins/select2/js/select2.full.min.js') }}"></script>    <script src="{{ buildStaticUrl('plugins/multi-select/js/jquery.quicksearch.js') }}"></script>    <script src="{{ buildStaticUrl('plugins/multi-select/js/jquery.multi-select.js') }}"></script>    <script src="{{ buildStaticUrl('js/pages/form-select-custom.js') }}"></script>    <script src="{{ buildStaticUrl('plugins/footable/js/footable.min.js') }}"></script>    <script>        window.onload = function () {            myPagination = new myPagination({                id: 'pagination',                curPage: {{ curPage }}, //初始页码                pageTotal: {{ pageTotal }}, //总页数                pageAmount: 100,  //每页多少条                dataTotal: {{ totalCount }}, //总共多少条数据                pageSize: 100, //可选,分页个数                showPageTotalFlag: true, //是否显示数据统计                showSkipInputFlag: false, //是否支持跳转                getPage: function (page) {                    //获取当前页数                    console.log(page);                    window.location.href = common_ops.buildUrl("/admin/count?page=" + page);                }            });        };        function setValue(id) {            var cstr = id + 'inval';            let count = parseInt($("input[id=" + cstr + "]").val());            cstr = id + 'num';            let num = parseInt($("td[id=" + cstr + "]")[0].innerText);            let ss = (num / count).toFixed(2) * 100;            cstr = id + 'valee';            $("td[id=" + cstr + "]")[0].innerText = ss + '%';            $.ajax({                type: 'POST',                url: common_ops.buildUrl("/admin/updateCount?id=" + id),                data: {'num': count, percent: ss},                dataType: 'json',                success: function (data) {                }            });            {#var invals =document.getElementsByClassName('inval');#}            {#var valee =document.getElementsByClassName('valee');#}            {#var totalNum1 = 0;#}            {#var totalNum2 = 0;#}            {##}            {#for (let i =1; i < invals.length; i++) {#}            {#    if ($('#'+invals[i].id).val() != "") {#}            {#        totalNum1 += parseInt($('#' + invals[i].id).val())#}            {#    }#}            {#}#}                {#for (let i =1; i < valee.length; i++) {#}                {#    if ($('#'+valee[i].id)[0].innerHTML != undefined && $('#'+valee[i].id)[0].innerHTML!="") {#}                {#        totalNum2 += parseInt($('#' + valee[i].id)[0].innerText.split('%')[0])#}                {#    }#}                {#}#}                    {#$('#totalNum1')[0].innerText = totalNum1;#}                    {#$('#totalNum2')[0].innerText = (totalNum2/valee.length) + "%" ;#}                }                $("#f0").on("change", function () {                    fid = $("#f0").val();                    $.ajax({                        type: 'GET',                        url: common_ops.buildUrl("/f1?id=" + fid),                        dataType: 'json',                        success: function (data) {                            var result = '';                            //alert(data)                            if (data.length == 0) {                                return false;                            } else {                                var arrLen = data.length;                            }                            if (arrLen > 0) {                                result = "<option value='-1'>请选择</option>";                                for (let i = 0; i < arrLen; i++) {                                    result += '<option value="' + data[i].did + '">' + data[i].d_name + '</option>'                                }                                f2(data[0].did);                                $('#f1').html(result);                                $('#f1').show();                            }                        }                    });                });                $("#f1").on("change", function () {                    $("#buts").html('');                    fid = $("#f1").val();                    $.ajax({                        type: 'GET',                        url: common_ops.buildUrl("/f1?id=" + fid),                        dataType: 'json',                        success: function (data) {                            var result = '';                            //alert(data)                            if (data.length == 0) {                                reslt = '';                                $('#f2').html(reslt);                                $('#f3').html(reslt);                                $('#f4').html(reslt);                                return false;                            } else {                                var arrLen = data.length;                            }                            if (arrLen > 0) {                                result = "<option value='-1'>请选择</option>";                                for (var i = 0; i < arrLen; i++) {                                    result += '<option value="' + data[i].did + '">' + data[i].d_name + '</option>'                                }                                f3(data[0].did);                                $('#f2').html(result);                                $('#f2').show();                            }                        },                        error: function (xhr, type) {                        }                    });                });                function f1(id) {                    fid = id;                    $.ajax({                        type: 'GET',                        url: common_ops.buildUrl("/f1?id=" + fid),                        dataType: 'json',                        success: function (data) {                            var result = '';                            //alert(data)                            if (data.length == 0) {                                reslt = '';                                $('#f2').html(reslt);                                $('#f3').html(reslt);                                $('#f4').html(reslt);                                $("#buts").html('<input type="button"  onclick="sub()" value="下一步"> ');                                return false;                            } else {                                var arrLen = data.length;                            }                            if (arrLen > 0) {                                result = "<option value='-1'>请选择</option>";                                for (var i = 0; i < arrLen; i++) {                                    result += '<option value="' + data[i].did + '">' + data[i].d_name + '</option>'                                }                                f2(data[0].did);                                $('#f1').html(result);                                // 如果没有数据                            } else {                                //  result += '<option value="0">默认</option>'                            }                        }                    });                }                function f2(id) {                    fid = id;                    $.ajax({                        type: 'GET',                        url: common_ops.buildUrl("/f1?id=" + fid),                        dataType: 'json',                        success: function (data) {                            var result = '';                            if (data.length == 0) {                                reslt = '';                                $('#f3').html(reslt);                                $('#f2').html(reslt);                                $('#f4').html(reslt);                                $("#buts").html('<input type="button"  onclick="sub()" value="下一步"> ')                                return false;                            } else {                                var arrLen = data.length;                            }                            if (arrLen > 0) {                                result = "<option value='-1'>请选择</option>";                                for (var i = 0; i < arrLen; i++) {                                    result += '<option value="' + data[i].did + '">' + data[i].d_name + '</option>'                                }                                f3(data[0].did);                                $('#f2').html(result);                            }                        },                        error: function (xhr, type) {                        }                    });                }                $("#f2").on("change", function () {                    $("#buts").html('');                    fid = $("#f2").val();                    $.ajax({                        type: 'GET',                        url: common_ops.buildUrl("/f1?id=" + fid),                        dataType: 'json',                        success: function (data) {                            var result = '';                            if (data.length == 0) {                                $("#buts").html('<input type="button"  onclick="sub()" value="下一步"> ')                                $('#f3').hide();                                $('#f4').hide();                                reslt = '';                                $('#f3').html(reslt);                                $('#f4').html(reslt);                                return false;                            } else {                                var arrLen = data.length;                            }                            if (arrLen > 0) {                                result = "<option value='-1'>请选择</option>";                                for (var i = 0; i < arrLen; i++) {                                    result += '<option value="' + data[i].did + '">' + data[i].d_name + '</option>'                                }                                f4(data[0].did);                                // 如果没有数据                                $('#f3').html(result);                                $('#f3').show();                                $("#buts").html('<input type="button"  onclick="sub()" value="下一步"> ')                            }                        },                        error: function (xhr, type) {                        }                    });                });                function f3(id) {                    fid = id;                    $.ajax({                        type: 'GET',                        url: common_ops.buildUrl("/f1?id=" + fid),                        dataType: 'json',                        success: function (data) {                            var result = '';                            if (data.length == 0) {                                $("#buts").html('<input type="button"  onclick="sub()" value="下一步"> ')                                $('#f4').hide();                                reslt = '';                                $('#f4').html(reslt);                                return false;                            } else {                                var arrLen = data.length;                            }                            if (arrLen > 0) {                                result = "<option value='-1'>请选择</option>";                                for (var i = 0; i < arrLen; i++) {                                    result += '<option value="' + data[i].did + '">' + data[i].d_name + '</option>'                                }                                f4(data[0].did);                                // 如果没有数据                                $('#f3').html(result);                                $('#f3').show();                                $("#buts").html('<input type="button"  onclick="sub()" value="下一步"> ')                            } else {                                result += '<option value="0">默认</option>'                            }                        },                        error: function (xhr, type) {                        }                    });                }                $("#f3").on("change", function () {                    $("#buts").html('');                    fid = $("#f3").val();                    $.ajax({                        type: 'GET',                        url: common_ops.buildUrl("/f1?id=" + fid),                        dataType: 'json',                        success: function (data) {                            var result = '';                            if (data.length == 0) {                                $("#buts").html('<input type="button"  onclick="sub()" value="下一步"> ')                                $('#f4').hide();                                reslt = '';                                $('#f4').html(reslt);                                return false;                            } else {                                var arrLen = data.length;                            }                            if (arrLen > 0) {                                result = "<option value='-1'>请选择</option>";                                for (var i = 0; i < arrLen; i++) {                                    result += '<option value="' + data[i].did + '">' + data[i].d_name + '</option>'                                }                                $('#f4').html(result);                                $('#f4').show();                                // 如果没有数据                            } else {                                result += '<option value="0">默认</option>'                                $('#f4').hide();                            }                            $('#f4').html(result);                        },                        error: function (xhr, type) {                        }                    });                });                function f4(id) {                    fid = id;                    $.ajax({                        type: 'GET',                        url: common_ops.buildUrl("/f1?id=" + fid),                        dataType: 'json',                        success: function (data) {                            var result = '';                            if (data.length == 0) {                                $("#buts").html('<input type="button"  onclick="sub()" value="下一步"> ')                                $('#f4').hide();                                reslt = '';                                $('#f4').html(reslt);                                return false;                            } else {                                var arrLen = data.length;                            }                            if (arrLen > 0) {                                result = "<option value='-1'>请选择</option>";                                for (var i = 0; i < arrLen; i++) {                                    result += '<option value="' + data[i].did + '">' + data[i].d_name + '</option>'                                }                                // 如果没有数据                                $('#f4').html(result);                                $('#f4').show();                                $("#buts").html('<input type="button"  onclick="sub()" value="下一步"> ')                            }                        },                        error: function (xhr, type) {                        }                    });                }                function search() {                    fid = $("#f1").val();                    f0 = $("#f0").val();                    ff2 = $("#f2").val();                    ff3 = $("#f3").val();                    ff4 = $("#f4").val();                    window.location.href = common_ops.buildUrl("/admin/count?f0=" + f0 + "&f1=" + fid + "&f2=" + ff2 + "&f3=" + ff3 + "&f4=" + ff4);                }    </script>{% endblock %}